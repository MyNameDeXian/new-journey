<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		html,body{
			height: 100%;
		}
		.ctr{
			margin: auto;
			width: 50%;
			border: 1px solid #333;
			display: flex;
			flex-flow: row wrap;
			overflow: hidden;
		}
		.box{
			position: relative;
			flex: none;
			margin: 10px 0;
			padding: 0;
			box-sizing: border-box;
			width: 50%;
			height: 50px;
			border: 1px solid #333;
			z-index: 10;
		}
		.box div{
			width: 20%;
			height: 20px;
			border: 1px solid #333;
		}
		.test{
			transition: height 1s;
			background: #089;
		}
		.test:hover{
			height: 0;
		}
		.open{
			animation: open .4s forwards;
		}
		.close{
			animation: close .4s forwards;
		}
		@keyframes open{
		  0%{
		    height: 20px;
		  }
		  100%{
		    height: 100px;
		  }
		}
		@keyframes close{
		  0%{
		    height: 100px;
		  }
		  100%{
		    height: 20px;
		  }
		}
	</style>
	<script>
		let dom = null;
		let move = null;
		let moveIndex = null;
		let overIndex = null;
		let start = null;
		let overDom = null;
		let draggable = false;
		function getIndex(dom){
			let boxs = document.getElementsByClassName('box');
			boxs = Array.prototype.slice.call(boxs)
			return boxs.indexOf(dom);
		}
		function mousemove(e){
			if( draggable === false ) return;
			let x = e.clientX;
			let y = e.clientY;
			move = [x, y];
			dom.style.transform = `translate(${ x - start[0] }px, ${ y - start[1] }px)`;
			dom.style.opacity = '0.4';
			dom.style.zIndex = '1';
			// console.log(e.target)
		}
		function mousedown(e){
			console.log(e)
			draggable = true;
			let x = e.clientX;
			let y = e.clientY;
			start = [x, y];
			dom = e.target;
			moveIndex = getIndex(dom);
			console.log(moveIndex)
		}
		function mouseover(e){
			if(draggable === false) return;
			overDom = e.target;
			if(overDom.className !== 'box') return;
			overIndex = getIndex(overDom);
			let num = moveIndex - overIndex; 
			let ram = num % 2;
			if(num > 0){ // 大于 0 时时向左 或 向上移动
				if(ram === 1){ //向左
					overDom.style.transform = `translate(100%, 0)`;
				} else { //向上
					let next = overDom.nextSibling;
			console.log(next)
					let nx = next.offsetLeft;
					let ny = next.offsetTop;
					let x = overDom.offsetLeft;
					let y = overDom.offsetTop;
					next.style.transform = `translate(100%, 0)`;
					overDom.style.transform = `translate(${nx-x}px, ${ny-y}px)`;
				} 
			} else { // 向右 或 向下移动

			}
			console.log(num, ram,moveIndex, overIndex)
		}
		function mouseup(e){
			dom.style.transform = '';
			dom.style.opacity = '';
			dom.style.zIndex = '';
			dom = null;
		 	move = null;
			start = null;
			overDom = null;
			draggable = false;
		}
		function mouseout(e){
			console.log(121)
		}
		function closeBox(e){
			window.e = e;
			e.preventDefault();
			let removeDom = e.target.parentNode;
			let parent = removeDom.parentNode;
			parent.removeChild(removeDom);
			console.log(1111)
		}
	</script>
</head>
<body>
	<div class="ctr" id='ctr' onmousemove='mousemove(event)'>
		<div class='box'onmouseover='mouseover(event)' onmouseout='mouseout(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>1</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>2</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>3</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>4</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>5</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>6</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>7</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>8</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>9</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>10</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)' >
			<div onclick='closeBox(event)'>11</div>
		</div>
		<div class='box'onmouseover='mouseover(event)' onmouseup='mouseup(event)' onmousedown='mousedown(event)'>
			<div onclick='closeBox(event)'>12</div>
		</div>
	</div>
		<div id='test' class='test'>111111111111111</div>
		<div>1222222222222222</div>
</body>
<script>
	document.body.firstElementChild.firstElementChild.remove()
	document.getElementById('test').addEventListener('click', function(e){
		let el = e.target;
		let close = e.target.className.indexOf('close')
		if(close === -1){
			el.classList.remove('open')
			el.classList.add('close')
		} else {
			el.classList.remove('close')
			el.classList.add('open')
		}
	})
</script>
	
</html>